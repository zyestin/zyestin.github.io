<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>用脚手架 制作一个RN库 放npm | zyestin</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="脚手架 create-react-native-module
脚手架使用（顺利） 工具安装 npm install -g yarn npm install -g create-react-native-module 脚手架命令 create-react-native-module RemoteFont --object-class-name react-native-remote-font --object-class-name RemoteFontLoader --native-package-id com.yestin.font --platforms ios,android --github-account zyestin --author-name yestin --author-email zyestin@gmail.com --generate-example --example-react-native-template react-native@0.62 过程中发现，若不指定--example-react-native-template react-native@0.62，发现总有这样的报错日志
pod --version failure, aborting with broken example app Error while creating library module react-native-remote-font Error: Command failed with ENOENT: pod --version spawnSync pod ENOENT at Object.spawnSync (internal/child_process.js:1077:20) at Object.spawnSync (child_process.js:776:24) at Function.module.exports.sync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:174:25) at module.exports.commandSync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:235:15) at /usr/local/lib/node_modules/create-react-native-module/lib/lib.">
    <meta name="generator" content="Hugo 0.122.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/zyestin/ananke/css/main.min.css" >



    
    
    
      
<link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/51897571?s=40&amp;v=4" type="image/x-icon" />


    

    
    
    <meta property="og:title" content="用脚手架 制作一个RN库 放npm" />
<meta property="og:description" content="脚手架 create-react-native-module
脚手架使用（顺利） 工具安装 npm install -g yarn npm install -g create-react-native-module 脚手架命令 create-react-native-module RemoteFont --object-class-name react-native-remote-font --object-class-name RemoteFontLoader --native-package-id com.yestin.font --platforms ios,android --github-account zyestin --author-name yestin --author-email zyestin@gmail.com --generate-example --example-react-native-template react-native@0.62 过程中发现，若不指定--example-react-native-template react-native@0.62，发现总有这样的报错日志
pod --version failure, aborting with broken example app Error while creating library module react-native-remote-font Error: Command failed with ENOENT: pod --version spawnSync pod ENOENT at Object.spawnSync (internal/child_process.js:1077:20) at Object.spawnSync (child_process.js:776:24) at Function.module.exports.sync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:174:25) at module.exports.commandSync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:235:15) at /usr/local/lib/node_modules/create-react-native-module/lib/lib." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zyestin.github.io/zyestin/posts/rn/create-npm-lib/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-01T12:00:11+08:00" />
<meta property="article:modified_time" content="2023-11-01T12:00:11+08:00" />

<meta itemprop="name" content="用脚手架 制作一个RN库 放npm">
<meta itemprop="description" content="脚手架 create-react-native-module
脚手架使用（顺利） 工具安装 npm install -g yarn npm install -g create-react-native-module 脚手架命令 create-react-native-module RemoteFont --object-class-name react-native-remote-font --object-class-name RemoteFontLoader --native-package-id com.yestin.font --platforms ios,android --github-account zyestin --author-name yestin --author-email zyestin@gmail.com --generate-example --example-react-native-template react-native@0.62 过程中发现，若不指定--example-react-native-template react-native@0.62，发现总有这样的报错日志
pod --version failure, aborting with broken example app Error while creating library module react-native-remote-font Error: Command failed with ENOENT: pod --version spawnSync pod ENOENT at Object.spawnSync (internal/child_process.js:1077:20) at Object.spawnSync (child_process.js:776:24) at Function.module.exports.sync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:174:25) at module.exports.commandSync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:235:15) at /usr/local/lib/node_modules/create-react-native-module/lib/lib."><meta itemprop="datePublished" content="2023-11-01T12:00:11+08:00" />
<meta itemprop="dateModified" content="2023-11-01T12:00:11+08:00" />
<meta itemprop="wordCount" content="1288">
<meta itemprop="keywords" content="react-native," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="用脚手架 制作一个RN库 放npm"/>
<meta name="twitter:description" content="脚手架 create-react-native-module
脚手架使用（顺利） 工具安装 npm install -g yarn npm install -g create-react-native-module 脚手架命令 create-react-native-module RemoteFont --object-class-name react-native-remote-font --object-class-name RemoteFontLoader --native-package-id com.yestin.font --platforms ios,android --github-account zyestin --author-name yestin --author-email zyestin@gmail.com --generate-example --example-react-native-template react-native@0.62 过程中发现，若不指定--example-react-native-template react-native@0.62，发现总有这样的报错日志
pod --version failure, aborting with broken example app Error while creating library module react-native-remote-font Error: Command failed with ENOENT: pod --version spawnSync pod ENOENT at Object.spawnSync (internal/child_process.js:1077:20) at Object.spawnSync (child_process.js:776:24) at Function.module.exports.sync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:174:25) at module.exports.commandSync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:235:15) at /usr/local/lib/node_modules/create-react-native-module/lib/lib."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/zyestin/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        <img src="https://avatars.githubusercontent.com/u/51897571?s=40&amp;v=4" class="w100 mw5-ns" alt="zyestin" />
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
    
    <a href="https://zyestin.github.io/zyestin/posts/rn/readme/" target="_blank" rel="noopener" class="ALL ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="ALL link" aria-label="follow on ALL——Opens in a new window">
      
        ALL
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://github.com/zyestin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.jianshu.com/u/3601cd1fe82d" target="_blank" rel="noopener" class="jianshu ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Jian link" aria-label="follow on Jian——Opens in a new window">
      
        Jian
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://blog.csdn.net/wustzhy2016" target="_blank" rel="noopener" class="CSDN ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="csdn link" aria-label="follow on csdn——Opens in a new window">
      
        csdn
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">用脚手架 制作一个RN库 放npm</h1>
      
      <p class="tracked">
        By <strong>yestin</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2023-11-01T12:00:11+08:00">November 1, 2023</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy avenir bg-near-white f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>脚手架 <a href="https://github.com/brodybits/create-react-native-module?tab=readme-ov-file">create-react-native-module</a></p>
<h2 id="脚手架使用顺利">脚手架使用（<strong>顺利</strong>）</h2>
<ul>
<li>工具安装</li>
</ul>
<pre tabindex="0"><code>npm install -g yarn
npm install -g create-react-native-module
</code></pre><ul>
<li>脚手架命令</li>
</ul>
<pre tabindex="0"><code>create-react-native-module RemoteFont --object-class-name react-native-remote-font --object-class-name RemoteFontLoader --native-package-id com.yestin.font --platforms ios,android --github-account zyestin --author-name yestin --author-email zyestin@gmail.com --generate-example --example-react-native-template react-native@0.62
</code></pre><p>过程中发现，若不指定<code>--example-react-native-template react-native@0.62</code>，发现总有这样的报错日志</p>
<pre tabindex="0"><code>pod --version failure, aborting with broken example app
Error while creating library module react-native-remote-font
Error: Command failed with ENOENT: pod --version
spawnSync pod ENOENT
    at Object.spawnSync (internal/child_process.js:1077:20)
    at Object.spawnSync (child_process.js:776:24)
    at Function.module.exports.sync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:174:25)
    at module.exports.commandSync (/usr/local/lib/node_modules/create-react-native-module/node_modules/execa/index.js:235:15)
    at /usr/local/lib/node_modules/create-react-native-module/lib/lib.js:265:17
    at new Promise (&lt;anonymous&gt;)
    at /usr/local/lib/node_modules/create-react-native-module/lib/lib.js:223:18
</code></pre><p>成功的日志</p>
<pre tabindex="0"><code>CREATE new React Native module with the following options:

                        name: RemoteFont
           full package name: react-native-remote-font
                     is view: false
           object class name: RemoteFontLoader
     Android nativePackageId: com.yestin.font
                   platforms: ios,android
           Apple tvosEnabled: false
                  authorName: yestin
                 authorEmail: zyestin@gmail.com
        author githubAccount: zyestin
                     license: MIT
          useAppleNetworking: false

             generateExample: true
          exampleFileLinkage: false
                 exampleName: example
  exampleReactNativeTemplate: react-native@0.62
         writeExamplePodfile: false

CREATE: Check for valid Yarn CLI tool version, as needed to generate the example project
1.22.21
yarn --version ok
CREATE: Generating the React Native library module
CREATE example app with the following template: react-native@0.62
                                                          
               ######                ######               
             ###     ####        ####     ###             
            ##          ###    ###          ##            
            ##             ####             ##            
            ##             ####             ##            
            ##           ##    ##           ##            
            ##         ###      ###         ##            
             ##  ########################  ##             
          ######    ###            ###    ######          
      ###     ##    ##              ##    ##     ###      
   ###         ## ###      ####      ### ##         ###   
  ##           ####      ########      ####           ##  
 ##             ###     ##########     ###             ## 
  ##           ####      ########      ####           ##  
   ###         ## ###      ####      ### ##         ###   
      ###     ##    ##              ##    ##     ###      
          ######    ###            ###    ######          
             ##  ########################  ##             
            ##         ###      ###         ##            
            ##           ##    ##           ##            
            ##             ####             ##            
            ##             ####             ##            
            ##          ###    ###          ##            
             ###     ####        ####     ###             
               ######                ######               
                                                          

                  Welcome to React Native!                
                 Learn once, write anywhere               

✔ Downloading template
✔ Copying template
✔ Processing template
✔ Installing CocoaPods dependencies (this may take a few minutes)

  
  Run instructions for Android:
    • Have an Android emulator running (quickest way to get started), or a device connected.
    • cd &#34;/Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example&#34; &amp;&amp; npx react-native run-android
  
  Run instructions for iOS:
    • cd &#34;/Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example&#34; &amp;&amp; npx react-native run-ios
    - or -
    • Open example/ios/example.xcworkspace in Xcode or run &#34;xed -b ios&#34;
    • Hit the Run button
    
  Run instructions for macOS:
    • See https://aka.ms/ReactNativeGuideMacOS for the latest up-to-date instructions.
    
  
Linking the new module library to the example app
yarn add v1.22.21
[1/4] 🔍  Resolving packages...
[2/4] 🚚  Fetching packages...
[3/4] 🔗  Linking dependencies...
warning &#34;@react-native-community/eslint-config &gt; @typescript-eslint/eslint-plugin@1.13.0&#34; has incorrect peer dependency &#34;eslint@^5.0.0&#34;.
warning &#34;@react-native-community/eslint-config &gt; @typescript-eslint/parser@1.13.0&#34; has incorrect peer dependency &#34;eslint@^5.0.0&#34;.
warning &#34;@react-native-community/eslint-config &gt; eslint-plugin-react@7.12.4&#34; has incorrect peer dependency &#34;eslint@^3.0.0 || ^4.0.0 || ^5.0.0&#34;.
warning &#34;@react-native-community/eslint-config &gt; eslint-plugin-react-native@3.6.0&#34; has incorrect peer dependency &#34;eslint@^3.17.0 || ^4 || ^5&#34;.
warning &#34;@react-native-community/eslint-config &gt; @typescript-eslint/eslint-plugin &gt; tsutils@3.21.0&#34; has unmet peer dependency &#34;typescript@&gt;=2.8.0 || &gt;= 3.2.0-dev || &gt;= 3.3.0-dev || &gt;= 3.4.0-dev || &gt;= 3.5.0-dev || &gt;= 3.6.0-dev || &gt;= 3.6.0-beta || &gt;= 3.7.0-dev || &gt;= 3.7.0-beta&#34;.
[4/4] 🔨  Building fresh packages...
success Saved lockfile.
success Saved 1 new dependency.
info Direct dependencies
└─ react-native-remote-font@0.0.0
info All dependencies
└─ react-native-remote-font@0.0.0
✨  Done in 2.18s.
check for valid pod version in /Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example/ios
Ignoring ffi-1.15.5 because its extensions are not built. Try: gem pristine ffi --version 1.15.5
Ignoring json-2.6.2 because its extensions are not built. Try: gem pristine json --version 2.6.2
1.11.3
running pod install in /Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example/ios
Ignoring ffi-1.15.5 because its extensions are not built. Try: gem pristine ffi --version 1.15.5
Ignoring json-2.6.2 because its extensions are not built. Try: gem pristine json --version 2.6.2
Auto-linking React Native module for target `example`: react-native-remote-font
Analyzing dependencies
Downloading dependencies
Installing react-native-remote-font (1.0.0)
Generating Pods project
Integrating client project
Pod installation complete! There are 48 dependencies from the Podfile and 38 total pods installed.

[!] Your project does not explicitly specify the CocoaPods master specs repo. Since CDN is now used as the default, you may safely remove it from your repos directory via `pod repo remove master`. To suppress this warning please add `warn_for_unused_master_specs_repo =&gt; false` to your Podfile.

📚  Created library module react-native-remote-font in `./react-native-remote-font`.
🕘  It took 234511ms.

====================================================
YOU&#39;RE ALL SET!

💡 check out the example app in react-native-remote-font/example
💡 recommended: run Metro Bundler in a new shell
ℹ (cd react-native-remote-font/example &amp;&amp; yarn start)
💡 enter the following commands to run the example app:
ℹ cd react-native-remote-font/example
ℹ yarn ios # for React Native 0.60: npx react-native run-ios
ℹ yarn android # for React Native 0.60: npx react-native run-android
⚠ IMPORTANT NOTICES
⚠ After clean checkout, these first steps are needed:
ℹ run Yarn in react-native-remote-font/example/ios
ℹ (cd react-native-remote-font/example &amp;&amp; yarn)
ℹ do `pod install` for iOS in react-native-remote-font/example/ios
ℹ cd react-native-remote-font/example
ℹ (cd ios &amp;&amp; pod install)
⚠ KNOWN ISSUE with adding dependencies to the library root
ℹ see https://github.com/brodybits/create-react-native-module/issues/308
</code></pre><ul>
<li>目录结构</li>
</ul>
<pre tabindex="0"><code>ll -alh react-native-remote-font                                                                                                    14:29:53

total 40
.
..
.gitignore
README.md
android
example
index.js
ios
package.json
react-native-remote-font.podspec
</code></pre><p>android目录</p>
<pre tabindex="0"><code>tree react-native-remote-font/android                                                                                               11:32:42
react-native-remote-font/android
├── README.md
├── build.gradle
└── src
    └── main
        ├── AndroidManifest.xml
        └── java
            └── com
                └── yestin
                    └── font
                        ├── RemoteFontLoaderModule.java
                        └── RemoteFontLoaderPackage.java
</code></pre><p>ios目录</p>
<pre tabindex="0"><code>tree react-native-remote-font/ios                                                                                                   11:38:56
react-native-remote-font/ios
├── RemoteFontLoader.h
├── RemoteFontLoader.m
├── RemoteFontLoader.xcodeproj
│   └── project.pbxproj
└── RemoteFontLoader.xcworkspace
    └── contents.xcworkspacedata
</code></pre><h2 id="运行ios较顺利">运行iOS（<strong>较顺利</strong>）</h2>
<p>如RN0.62老样子，App成功启动了，<br>
但弹窗报错<code>React Native: Unexpected token ':'. Expected a ')'</code></p>
<p>这样改<code>metro-react-native-babel-preset from 0.58.0 to 0.59.0</code></p>
<p>然后<code>yarn install &amp;&amp; npx pod-install</code> 后，<br>
重新<code>Xcode run iOS</code>就OK了</p>
<p><img src="media/17025205209135/17025377737514.jpg" alt=""></p>
<h2 id="将自定义三方库代码写入有坑">将自定义三方库代码写入（<strong>有坑</strong>）</h2>
<h3 id="输入-本库代码">输入 本库代码</h3>
<p>直接在顶层目录 改三方库代码就行</p>
<blockquote>
<p>因为<code>example</code>内所使用的<code>react-native-remote-font</code>文件，是软链，指向到顶层目录的
<img src="media/17025205209135/17025382047259.jpg" alt=""></p>
</blockquote>
<h3 id="添加-其它依赖库挺坑">添加 其它依赖库（<strong>挺坑</strong>）</h3>
<p>直接在<code>package.json</code>里添加如上依赖后，<code>yarn &amp;&amp; npx pod-install</code>后，Xcode run 报错如下，多次这样后，还是报错。。。</p>
<pre tabindex="0"><code>error: Error: Unable to resolve module react-native-fs from /Users/yestin/Desktop/code_test/react-native/react-native-remote-font/index.js: react-native-fs could not be found within the project or in these directories:
  /Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example/node_modules

If you are sure the module exists, try these steps:
 1. Clear watchman watches: watchman watch-del-all
 2. Delete node_modules and run yarn install
 3. Reset Metro&#39;s cache: yarn start --reset-cache
 4. Remove the cache: rm -rf /tmp/metro-*
  10 | } from &#34;react-native&#34;;
  11 | import React, { useEffect, useMemo, useRef, useState } from &#34;react&#34;;
&gt; 12 | import RNFS from &#34;react-native-fs&#34;;
     |                   ^
</code></pre><p>按照上面的提示，执行</p>
<pre tabindex="0"><code>watchman watch-del-all  
rm -rf node_modules 
yarn &amp;&amp; npx pod-install
</code></pre><p>也终于在 node_modules下 能看到了 <code>react-native-fs</code>
<img src="media/17025205209135/17025418715348.jpg" alt=""></p>
<p>此时，居然还没有好，报错</p>
<pre tabindex="0"><code>Invariant Violation: Native module cannot be null
</code></pre><p>因Xcode 并没有link到这个库的iOS代码<code>RNFS</code>，Xcode里完全搜不到</p>
<p>于是 往<code>example/ios/Podfile</code>里手动添加link</p>
<pre tabindex="0"><code>pod &#39;RNFS&#39;, :path =&gt; &#39;../node_modules/react-native-fs&#39;
</code></pre><p>再<code>npx pod-install</code>后 就好了</p>
<blockquote>
<p>我把这个临时方案提供到了<a href="https://github.com/brodybits/create-react-native-module/issues/489#issuecomment-1855452220">create-react-native-module/issues/489#</a></p>
</blockquote>
<h2 id="写demo测试">写Demo测试</h2>
<p>从 <a href="https://fonts.google.com/specimen/Ma+Shan+Zheng">Google Fonts</a> 扒一些字体链接</p>
<pre tabindex="0"><code>const fontInfoList = [
  {
    fontName: &#34;Ma Shan Zheng&#34;,
    fontUrl: &#34;https://fonts.gstatic.com/s/mashanzheng/v10/NaPecZTRCLxvwo41b4gvzkXaRMHsCoRTJKKTqxFXqIji1hn3wSpSEA3eSpJy0awdsFt2Zfc6SSE.119.woff2&#34;,
  },
  {
    fontName: &#34;Afacad&#34;,
    fontUrl: &#34;https://fonts.gstatic.com/s/afacad/v1/6NUI8FKMIQOGaw6ahLYEvBjUVG5Ga92uVSQ-9kKlZfNfuw.ttf&#34;,
  },
  {
    fontName: &#34;Rubik Bubbles&#34;,
    fontUrl:
      &#34;https://fonts.gstatic.com/s/rubikbubbles/v3/JIA1UVdwbHFJtwA7Us1BPFbRNTENfDxyRXI.ttf&#34;,
  },
  {
    fontName: &#34;Preahvihear&#34;,
    fontUrl: &#34;https://fonts.gstatic.com/s/preahvihear/v29/6NUS8F-dNQeEYhzj7uluxswE49FJf8Wv.ttf&#34;,
  },
];
</code></pre><p>测试的核心代码</p>
<pre tabindex="0"><code>  &lt;ArtText
    text=&#34;Hello World&#34;
    style={{ fontSize: 20, fontVariant: [&#34;proportional-nums&#34;] }}
    fontInfo={fontInfoList[fontInfoIndex]}
  /&gt;
</code></pre><hr>
<p>同样，将安卓代码放进去</p>
<h2 id="运行-android挺坑">运行 Android（<strong>挺坑</strong>）</h2>
<p>yarn android报错</p>
<h3 id="1-failed-to-transform-react-native-0710-rc0-debugaar">(1) <code>Failed to transform react-native-0.71.0-rc.0-debug.aar</code></h3>
<pre tabindex="0"><code>* What went wrong:
Execution failed for task &#39;:react-native-remote-font:javaPreCompileDebug&#39;.
&gt; Could not resolve all files for configuration &#39;:react-native-remote-font:debugCompileClasspath&#39;.
   &gt; Failed to transform react-native-0.71.0-rc.0-debug.aar (com.facebook.react:react-native:0.71.0-rc.0) to match attributes {artifactType=android-classes, com.android.build.api.attributes.BuildTypeAttr=debug, org.gradle.category=library, org.gradle.dependency.bundling=external, org.gradle.libraryelements=aar, org.gradle.status=release, org.gradle.usage=java-api}.
      &gt; Execution failed for JetifyTransform: /Users/yestin/.gradle/caches/modules-2/files-2.1/com.facebook.react/react-native/0.71.0-rc.0/7a7f5a0af6ebd8eb94f7e5f7495e9d9684b4f543/react-native-0.71.0-rc.0-debug.aar.
         &gt; Java heap space
</code></pre><p>查到是RN的原因了，照着这个回答 <a href="https://github.com/facebook/react-native/issues/35210#issuecomment-1304536693">react-native/issues/35210#issuecomment-1304536693</a></p>
<p>在<code>react-native-remote-font/example/android/build.gradle</code>添加如下代码</p>
<pre tabindex="0"><code>def REACT_NATIVE_VERSION = new File([&#39;node&#39;, &#39;--print&#39;,&#34;JSON.parse(require(&#39;fs&#39;).readFileSync(require.resolve(&#39;react-native/package.json&#39;), &#39;utf-8&#39;)).version&#34;].execute(null, rootDir).text.trim())

allprojects {
    configurations.all {
        resolutionStrategy {
            // Remove this override in 0.66, as a proper fix is included in react-native itself.
            force &#34;com.facebook.react:react-native:&#34; + REACT_NATIVE_VERSION
        }
    }
</code></pre><p>再次 <code>yarn android</code> App成功安装启动，但依然报错</p>
<h3 id="2-也遇到-link问题">(2) 也遇到 Link问题</h3>
<ul>
<li>build error 找不到符号<code>RNFSPackage</code></li>
</ul>
<pre tabindex="0"><code>/Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example/android/app/src/main/java/com/example/MainApplication.java:31: 错误: 找不到符号
            packages.add(new RNFSPackage());
                             ^
  符号: 类 RNFSPackage

* What went wrong:
Execution failed for task &#39;:app:compileDebugJavaWithJavac&#39;.
&gt; Compilation failed; see the compiler error output for details.
</code></pre><p>在<code>build.gradle</code>的<code>dependencies {...}</code>内添加</p>
<pre tabindex="0"><code>    implementation project(&#39;:react-native-fs&#39;)
</code></pre><ul>
<li>build error <code>':react-native-fs' could not be found in project ':app'</code></li>
</ul>
<pre tabindex="0"><code>FAILURE: Build failed with an exception.

* Where:
Build file &#39;/Users/yestin/Desktop/code_test/react-native/react-native-remote-font/example/android/app/build.gradle&#39; line: 197

* What went wrong:
A problem occurred evaluating project &#39;:app&#39;.
&gt; Project with path &#39;:react-native-fs&#39; could not be found in project &#39;:app&#39;.
</code></pre><p>在<code>settings.gradle</code> 添加 path</p>
<pre tabindex="0"><code>include &#39;:react-native-fs&#39;
project(&#39;:react-native-fs&#39;).projectDir = new File(rootProject.projectDir, &#39;../node_modules/react-native-fs/android&#39;)
</code></pre><p>运行成功了，但弹窗报错</p>
<ul>
<li>build error <code>TypeError: null ... RNFSManager</code></li>
</ul>
<pre tabindex="0"><code>TypeError: null is not an object (evaluating &#39;RNFSManager.RNFSFileTypeRegular&#39;)
</code></pre><p>发现搜不到<code>RNFSManager</code>被引用的地方</p>
<p>于是在<code>MainApplication.java</code>中<code>getPackages(){...}</code>内添加</p>
<pre tabindex="0"><code>// react-native-fs
import com.rnfs.RNFSPackage;

packages.add(new RNFSPackage());
</code></pre><p>至此，终于 不报错了。。。</p>
<h2 id="发布">发布</h2>
<ul>
<li>确认本地是否成功登陆npm认证成功</li>
</ul>
<pre tabindex="0"><code>npm whoami

zyestin
</code></pre><blockquote>
<p>若未登录，则执行<code>npm adduser</code></p>
</blockquote>
<ul>
<li>执行<code>npm publish</code></li>
</ul>
<p>报错，是因为我刚删除了同名库，想重发一个，却失败了。<br>
而npm规则是 24小时才能发布刚删除的同名的包</p>
<pre tabindex="0"><code>18 http fetch PUT 403 https://registry.npmjs.org/react-native-remote-font 1544ms
19 verbose stack Error: 403 Forbidden - PUT https://registry.npmjs.org/react-native-remote-font - react-native-remote-font cannot be republished until 24 hours have passed.
</code></pre><ul class="pa0">
  
   <li class="list di">
     <a href="/zyestin/tags/react-native/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">react-native</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/waterfall-list-autoscroll/"> 实现 FlatList 、flashList、masonryFlashList 各种列表的自动滚动动画</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/multi-gestture-sticker/">RN 动画 - 缩放、旋转、拖拽</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/vscode-efficient/">React Native 在VSCode编码提效</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/readme/">React Native 开发沉淀</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/react-learn/">React 学习</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/react-hooks-dev-tool/">hooks开发工具</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/code-standards/">代码规范</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/react-hooks-course1/">学习《React Hooks 核心原理与实战》笔记</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/alert-multiple/">实现 差不多理想的极简RN弹窗</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/textinput-alert/">封装 低耦合、易用的文本输入框弹窗</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/base-components/">封装常用基础组件</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/douyin-label-input/">模仿抖音、小红书 输入 #标签 高亮</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/waterfall-list-horizontal/">横向 瀑布流列表</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zyestin/posts/rn/art-text/">远程字体的动态加载&amp;应用</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://zyestin.github.io/zyestin/" >
    &copy;  zyestin 2024 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://zyestin.github.io/zyestin/posts/rn/readme/" target="_blank" rel="noopener" class="ALL ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="ALL link" aria-label="follow on ALL——Opens in a new window">
      
        ALL
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://github.com/zyestin" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://www.jianshu.com/u/3601cd1fe82d" target="_blank" rel="noopener" class="jianshu ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Jian link" aria-label="follow on Jian——Opens in a new window">
      
        Jian
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://blog.csdn.net/wustzhy2016" target="_blank" rel="noopener" class="CSDN ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="csdn link" aria-label="follow on csdn——Opens in a new window">
      
        csdn
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
